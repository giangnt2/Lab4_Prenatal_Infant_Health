{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Lab 4: Does Prenatal Care Improve Infant Health?\"\nauthor: \"Carmen Easterwood, James Nguyen\"\ndate: \"April 23, 2017\"\noutput: pdf_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nload(\"bwght_w203.Rdata\")\nlibrary(lattice)\nlibrary(caret)\nlibrary(lmtest)\nlibrary(sandwich)\nlibrary(corrplot)\nlibrary(scales)\n\n\n```\n\n# Introduction\n\n# Exploratory Data Analysis\n\n```{r}\n### Clean up NA values \nv = na.exclude(data, complete.cases(v))\n\n# Might want to beef up this section \n\n#Mom\nhist(v$mage) #Very normal, avg late 20s\nhist(v$magesq) #Slightly right skewed\nhist(v$meduc) #Spikes at 12 and 16\nhist(v$cigs) #Big mass at 0. Right skewed. Above 20, corresponds to packs.\nhist(v$drink) #Big mass at 0. Right skewed.\n\n#Dad\nhist(v$fage) #Slight right skew, avg early 30s\nhist(v$feduc) #Spikes at 12 and 16\n\n#Prenatal care\nhist(v$monpre) #Majority begin in first 2 months; right skewed\nhist(v$npvis) #Spike at 10-15 visits\nhist(v$npvissq) #Right skewed\n\n#Baby\nhist(v$bwght) #Normalish, avg 3000-3500 grams (6.6-7.7 lbs)\nhist(v$lbwght) #Bit left skewed\nhist(v$omaps) #Left skewed, almost all 8 or 9\nhist(v$fmaps) #Left skewed, almost all 9\ntable(v$lbw) #Only 30 lbw (1.6%)\ntable(v$vlbw) #Only 13 vlbw (0.7%)\ntable(v$male) #941 male (51.4%)\n\n\n```\n\n\n```{r}\n#Race Table\nmrace <- as.factor(c())\nlevels(mrace) <- c(\"white\", \"black\", \"other\")\n\nfor (i in 1:length(v$bwght)){\n  if (v[i,]$mwhte == 1) {mrace[i] <- \"white\"}\n  else if (v[i,]$mblck == 1) {mrace[i] <- \"black\"}\n  else if (v[i,]$moth == 1) {mrace[i] <- \"other\"}\n}\n\nfrace <- as.factor(c())\nlevels(frace) <- c(\"white\", \"black\", \"other\")\n\nfor (i in 1:length(v$bwght)){\n  \n  if (v[i,]$fwhte == 1) {frace[i] <- \"white\"}\n  else if (v[i,]$fblck == 1) {frace[i] <- \"black\"}\n  else if (v[i,]$foth == 1) {frace[i] <- \"other\"}\n}\n\ntable(mrace, frace)\n\n# Could do a boxplot by race, e.g.:\nboxplot(meduc ~ mrace, data = v)\n# But black & other plots don't have a lot of data\n```\n##Correlation analysis\nWe build a correlation matrix to identify pairs of variables that have high correlation relationship.\n```{r}\ncor=cor(v)\ncorrplot(cor, method=\"circle\",diag = FALSE)\n\n```\n\nLooking at the corelation matrix below, we can see that father and mother tend to be in the same race, father and mother's age are highly correlated and so are father's education and mother's education.\nAlso, the education of mother and father correlate positively with the number of visits. Highly educated parents tend to pay more prenatal care visits and do it earlier.\n\n\n# Model Specifications\n## General Approach\n###Develop outcome variable \nTo evaluate the well being of a newborn baby, we combine the APGA scores which evaluate the baby health right after birth with  weight which also represent an important aspect of a newborn baby's well being.\nThe new healthscore are weighted average of 5 minute APGA score, 10 minute APGA score and weight score. Because weight is in different scale so we rescale this variable to be in the same scale with APGA scores.\nWe assume weight is more important than APGA score in this exersize so we give it a weight of 2 in the average fomular.\n```{r}\n\n\nv$weightScore <-rescale(v$bwght,to=c(0,10))\nv$healthScore = (v$omaps+v$fmaps+v$weightScore)/3\nhist(v$healthScore)  \nhist(v$omaps)\nhist(v$fmaps)\nhist(weightScore)\n                                            \n                                          \n```\nUnlinke weight distribution healthScore tend to skew to the right that reflect majority of newborn babies in the survey are in good state.\n###Selection of independent variables \nWe will not include outcome variables such as lbw, vlbw, bwght, fmaps, omaps in any model as these variables are after the fact do not help explain the questions of problem.\nBased on EDA, we will also not include highly correlated variables together in model 1, 2. For example knowing that mother's race and father's race are 90% correlated, we will not include them together.\n\n\n\n\n\n### Model 1\nBased on common sense, our variables of interest would be month prenatal care began (monpre), total number of prenatal visits (npvis).\n\n\n```{r}\n\nmodel1 <- lm(healthScore ~ monpre + npvis , data = v) \ncoeftest(model1, vcov = vcovHC) \nplot(model1) \nsummary(model1)$r.square\nAIC(model1)\ncor(v$monpre, v$npvis)\n\nvif(model1)\nbptest(model1)\nhist(model1$residuals)\n\n```\nThe coefficent variance test show that both npvis and npvissq are statistically significant with npvissq is not practically significant.\nFor the assumptions: \n- CLM3: No perfect collinearity but vif for both npvis and npvissq are high. This shows that this model is subject to multicollinearity problem\n- CLM4: Zero conditional mean ok\n- CLM 5: Based on the graph, it looks like the data isnâ€™t homoskedastic and shows that we should reject the\nnull, meaning the data is hetroskedastic\n- CML 6: data is not good at first but turn to normal with larger value \n\n### Model 2\n\nIn model 2, we add more variables that we believe will improve the accuracy of the prediction.\nFirst are the variables that are related to the mother and her behavior: age, drink, cigarette, education, her race\nWe do not include father information about age, education and race as we pointed out that father and mother information are highly correlated.\n\n```{r}\nmodel2 <- lm(healthScore ~ monpre + npvis+ cigs + drink + mage +  meduc +  male + mwhte +mblck, data = v)\ncoeftest(model2, vcov = vcovHC) # Significant vars: monpre (still positive), npvis, cigs, mage, male, moth\nplot(model2) # Meets assumptions relatively well\nAIC(model2) # Lower than model 1\nsummary(model2)$r.square\nvif(model2)\nbptest(model2)\n\n\n```\n-> Slight Improvement in accurancy (r squared improved and AIC is slightly reduced compared to model 1)\n\n### Model 3\n\n```{r}\nmodel3 <- lm(healthScore ~ monpre + npvis+ cigs + drink + mage +magesq+  meduc +  male + mwhte +mblck+fwhte+fblck, data = v)\ncoeftest(model3, vcov = vcovHC) # Same significant vars as model 2 except suddenly race coeficients become significant \nplot(model3) # Meets assumptions relatively well\nAIC(model3) # Basically the same as model 2\nsummary(model3)$r.square\nvif(model3)\n```\nSo in Model 3, we added variables about the father's races which earlier pointed out to be very closely correlated with mother's race. \nSome interesting effects now show up. mblck and mwhte coefficients now become significant but with negative values. This can be explained that in fact race is not significant but because we include highly correlated variables in, together they distort the test.  Father race have positive coefficient which is offsetted by negative coefficient values of mother race.\nAlso, the VIF score show high values for all race variables which cleary mean the model become multicollinear.\n\n\n# Assessment of CLM Assumptions\n\n### Model 1\n\n### Model 2\n\n### Model 3\n\n# Summary of Results\n\n# Causality\n\n# Conclusion\n",
    "created" : 1492493333091.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2737708314",
    "id" : "928A2D28",
    "lastKnownWriteTime" : 1492726508,
    "last_content_update" : 1492726508300,
    "path" : "C:/Users/TruongGiang/OneDrive/Work documents/MIDS Berkeley/W203-1/lab_4/Lab4_Prenatal_Infant_Health/Lab4_Carmen_James.Rmd",
    "project_path" : "Lab4_Carmen_James.Rmd",
    "properties" : {
        "last_setup_crc32" : "51BF1A6E47adf643"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}